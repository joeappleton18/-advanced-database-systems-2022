<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 3 (MongoDB Queries)</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/advanced-database-systems-2022/assets/css/0.styles.e3e38220.css" as="style"><link rel="preload" href="/advanced-database-systems-2022/assets/js/app.25060d71.js" as="script"><link rel="preload" href="/advanced-database-systems-2022/assets/js/2.4e8e5436.js" as="script"><link rel="preload" href="/advanced-database-systems-2022/assets/js/20.d353523c.js" as="script"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/10.71219751.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/11.0a7097b9.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/12.9a514739.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/13.37ac3cf3.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/14.f76d2289.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/15.7cdc89f5.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/16.1fd6f1d6.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/17.eb58facd.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/18.45298ffe.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/19.5a397dfd.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/21.3d564474.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/22.ddbb8864.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/23.178a88eb.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/24.59330243.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/25.3a112878.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/26.9470ba8d.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/27.d2f6d614.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/28.fce50eb8.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/29.5f2d7f4f.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/3.b7b06a35.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/30.2ade0da9.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/31.09f8303d.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/32.d9235770.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/33.d06a92b1.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/34.182d8852.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/35.593c18d5.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/36.7c69203c.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/37.486981cc.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/38.b1e8a5a3.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/4.ba265dd9.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/5.e650fc36.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/6.fd7168a9.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/7.3107b3b0.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/8.f1b2a5fc.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/9.9217b7bb.js">
    <link rel="stylesheet" href="/advanced-database-systems-2022/assets/css/0.styles.e3e38220.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/advanced-database-systems-2022/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Assessment 1</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 1 - Introduction to NodeJS and MongoDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 2 - Exploring Node, Express and Templates</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Week 3 - No Sql data planning and Modelling</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/advanced-database-systems-2022/sessions/week_3/lecture.html" class="sidebar-link">Lecture (Start Here)</a></li><li><a href="/advanced-database-systems-2022/sessions/week_3/" aria-current="page" class="active sidebar-link">Week 3 (MongoDB Queries)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advanced-database-systems-2022/sessions/week_3/#task-1-setting-up-our-sample-application" class="sidebar-link">Task 1 - Setting Up our Sample Application</a></li><li class="sidebar-sub-header"><a href="/advanced-database-systems-2022/sessions/week_3/#considering-the-current-data-shape" class="sidebar-link">Considering the Current Data Shape</a></li><li class="sidebar-sub-header"><a href="/advanced-database-systems-2022/sessions/week_3/#read" class="sidebar-link">Read</a></li><li class="sidebar-sub-header"><a href="/advanced-database-systems-2022/sessions/week_3/#task-2-reading-data" class="sidebar-link">Task 2 - Reading Data</a></li><li class="sidebar-sub-header"><a href="/advanced-database-systems-2022/sessions/week_3/#updating-and-writing-data" class="sidebar-link">Updating and Writing Data</a></li><li class="sidebar-sub-header"><a href="/advanced-database-systems-2022/sessions/week_3/#task-3-updating-data" class="sidebar-link">Task 3 - Updating Data</a></li><li class="sidebar-sub-header"><a href="/advanced-database-systems-2022/sessions/week_3/#advanced-tasks" class="sidebar-link">Advanced Tasks</a></li></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 4  - Completing the MVC stack</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 5 - Getting to Grips With the Assessment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 6 - Thinking About Updating Data</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 7 - Data Modeling and Relationships</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 8 - User Authentication</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 9 - Deploying to a Serverless Infrastructure</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="week-3-mongodb-queries"><a href="#week-3-mongodb-queries" class="header-anchor">#</a> Week 3 (MongoDB Queries)</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>Last week we considered how we could use NodeJS and the packages Express and ejs to construct the view layer of a data driven application. This week we will be continuing our journey by moving on to explore, the powers of the MongoDB data model.</p> <p><a href="https://www.kaggle.com/zynicide/wine-reviews" target="_blank" rel="noopener noreferrer">To assist us in gaining a better understanding of the powers of MongoDB, we are going to revisit our wine tasting dataset<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>For those of you that have explored this data set you would have observed some interesting properties. First, there are around 20k tastings with no attributed taster. Second, although there are ~130k records, there are only ~20 wine tasters - they've been busy! Observations such as this can be helpful in determining the utility of a data set.</p></div> <h3 id="task-0-windows-path-setting"><a href="#task-0-windows-path-setting" class="header-anchor">#</a> Task 0 - Windows Path Setting</h3> <p>If you are using windows, now is a good time to add the MongoDB folder as an environment variable. Further to this, you should also install the MongoDB Tools.</p> <ul><li><p><a href="https://stackoverflow.com/questions/31055637/getting-mongoimport-is-not-recognized-as-an-internal-or-external-command-ope" target="_blank" rel="noopener noreferrer">There is a good stack overflow answer that you can read here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>You will need to download <a href="https://www.mongodb.com/try/download/database-tools" target="_blank" rel="noopener noreferrer">MongoDB Tools<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p>Extract the zip file and move the contents to <code>C:\Program Files\MongoDB\Server\4.4\bin\</code></p></li> <li><p><a href="https://cloud.mongodb.com/v2/61532143efc0cc664129e20f#clusters/commandLineTools/Cluster0" target="_blank" rel="noopener noreferrer">If this does not work, please refer to the MongoDB documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li></ul> <h2 id="task-1-setting-up-our-sample-application"><a href="#task-1-setting-up-our-sample-application" class="header-anchor">#</a> Task 1 - Setting Up our Sample Application</h2> <p>For the rest of this unit, I will be providing you with a sample application which builds on our wine tasting dataset. I intend to ensure you are all starting with the same code base and will provide you with an up-to-date version the application each week. To get started this week: <code>git clone https://github.com/joeappleton18/db-starter-project</code></p> <ul><li><p><a href="https://github.com/joeappleton18/db-starter-project" target="_blank" rel="noopener noreferrer">Check the README.md instructions on the starter project to get started. This will tell you how to set everything up this week<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></li> <li><p>You'll notice, in the <code>README.md</code> instructions, you will need to seed the database and rename the &quot;.env.example&quot; file to &quot;.env&quot;. Further to this, you will also need to run the database seeder.</p></li> <li><p>You should take a look at the seeder.js file and ensure you have an idea how it works. Using a small side utility to seed a database is common.</p></li></ul> <h2 id="considering-the-current-data-shape"><a href="#considering-the-current-data-shape" class="header-anchor">#</a> Considering the Current Data Shape</h2> <p>Currently each document in our &quot;tastings&quot; collection looks, along the lines of, this:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;_id&quot;</span><span class="token operator">:</span> ObjectId(<span class="token string">&quot;5f88b504513221bee048d3dd&quot;</span>)<span class="token punctuation">,</span>
  <span class="token property">&quot;points&quot;</span><span class="token operator">:</span> <span class="token string">&quot;87&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;title&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Nicosia 2013 Vulkà Bianco  (Etna)&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Aromas include tropical fruit, broom, brimstone and dried herb. The palate isn't overly expressive, offering unripened apple, citrus and dried sage alongside brisk acidity.&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;taster_name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Kerin O’Keefe&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;taster_twitter_handle&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@kerinokeefe&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;price&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;designation&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Vulkà Bianco&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;variety&quot;</span><span class="token operator">:</span> <span class="token string">&quot;White Blend&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;region_1&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Etna&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;region_2&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span>
  <span class="token property">&quot;province&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Sicily &amp; Sardinia&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;country&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Italy&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;winery&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Nicosia&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><blockquote><blockquote><p>A single document from the tastings collection. Notice how MongoDB takes care of auto generating an ID for us.</p></blockquote></blockquote> <h2 id="read"><a href="#read" class="header-anchor">#</a> Read</h2> <p>To get you all started, let's explore some basic read operations that we might want to run on our collection.</p> <p>Access on of the following:</p> <ul><li>The MongoDB command line (for your home computer)</li> <li>The query runner that is in your starter project (<code>query-runner.js</code>)</li> <li>A MongoDB for VSCode Playground (recommend for university computers)</li></ul> <p>Run the following:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>use wine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>tastings<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Running the above command will return the first 20 records that match the query and a cursor to the remaining records. You'll notice in the command shell it will prompt you to 'type &quot;it&quot;' for more records.</p> <h3 id="further-refining-our-query"><a href="#further-refining-our-query" class="header-anchor">#</a> Further refining our query</h3> <p>Notice, above, how we passed into find what appears to be an empty object literal - <code>{}</code>. We can add name value pairings to this object to filter our results. Here are some basic examples:</p> <ul><li><strong><code>db.tastings.find({country: &quot;Italy&quot; })</code></strong> returns all wine tastings from Italy</li> <li><strong><code>db.tastings.find({country: &quot;Italy&quot;, price: {$lt:10}})</code></strong> returns all wine tastings from Italy where the price of the wine is less than 10</li></ul> <p>For a full list of operations you should read the <a href="https://docs.mongodb.com/manual/reference/operator/query/" target="_blank" rel="noopener noreferrer">documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. However, here is a slightly more interesting example:</p> <p><strong><code>db.tastings.find({$or: [{country: 'France'}, {country: 'Italy'}]})</code></strong> returns all wine tastings from Italy <strong>or</strong> France. We can also use the logical operators <strong><code>$not, $and, $nor</code></strong>.</p> <h3 id="mongo-allows-us-to-append-further-operations-to-a-given-query"><a href="#mongo-allows-us-to-append-further-operations-to-a-given-query" class="header-anchor">#</a> Mongo allows us to append further operations to a given query</h3> <p>As mentioned, when we execute a query MongoDb returns a cursor. A cursor has a whole suite of methods that we can run to further refine our data.</p> <p>Below are some useful methods, for a complete list of, what are know as cursor methods, <a href="https://docs.mongodb.com/manual/reference/method/js-cursor/" target="_blank" rel="noopener noreferrer">check the documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <ul><li><p><strong><code>db.tastings.find({}).count()</code></strong> returns the total number of records matching that query</p></li> <li><p><strong><code>db.tastings.find({}).limit(1)</code></strong> limits the amount of records contained in the cursor's result set</p></li> <li><p><strong><code>db.tastings.find({}).pretty()</code></strong> displays the results in an easy to read format</p></li> <li><p><strong><code>db.tastings.find({price: {$ne: null}}).sort({price: 1})</code></strong> Sorts the results in price order. <code>price: 1</code> tells MongoDB to display the results in ascending (increasing) order by price. <code>price: -1</code>, if you are feeling flush, displays the results in descending price order.</p></li></ul> <h2 id="task-2-reading-data"><a href="#task-2-reading-data" class="header-anchor">#</a> Task 2 - Reading Data</h2> <p>Use the notes above, and the <a href="https://docs.mongodb.com/" target="_blank" rel="noopener noreferrer">MongoDB documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to answer the following questions (you should aim to do so efficiently as possible):</p> <ul><li><p>How many records, in total, are there in the entire tastings collection?</p></li> <li><p>How many wine records exist that originated from Italy where the price is greater than 80?</p> <ul><li>List the results in descending order, so you can see the most expensive bottle of wine first.</li></ul></li> <li><p>How many wine records exist that originated from France or Italy, where the price is greater than 60?</p></li></ul> <p><strong>Did you fly through these tasks! Here are some more advanced, optional, questions</strong></p> <ul><li><p>Can you use the <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group" target="_blank" rel="noopener noreferrer">aggregation pipeline<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to determine the name of each wine taster and the count of the total tastings they have conducted?</p></li> <li><p>How many different regions are there?</p></li> <li><p>Can you work out the wine which has been tasted the most? I think it is &quot;Gloria Ferrer NV Sonoma Brut Sparkling (Sonoma County)&quot; which has been tasted 11 times.</p></li></ul> <h2 id="updating-and-writing-data"><a href="#updating-and-writing-data" class="header-anchor">#</a> Updating and Writing Data</h2> <p>Updating and writing data is very simple. For instance, we can simply run the following operation:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>tastings<span class="token punctuation">.</span><span class="token function">insertOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Toro Loco&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">taster_name</span><span class="token operator">:</span> <span class="token string">&quot;Joe Appleton&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">taster_twitter_handle</span><span class="token operator">:</span> <span class="token string">&quot;@joeappleton18&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token literal-property property">designation</span><span class="token operator">:</span> <span class="token string">&quot;Vulkà Bianco&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">variety</span><span class="token operator">:</span> <span class="token string">&quot;White Blend&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">region_1</span><span class="token operator">:</span> <span class="token string">&quot;Etna&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><blockquote><blockquote><p>FYI, Toro Loco is a very affordable wine from Aldi - I recommend it!</p></blockquote></blockquote> <p>Let's assume the price changes on our bottle of Toro Loco to 20. We could update the record using the following command:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>tastings<span class="token punctuation">.</span><span class="token function">updateOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Toro Loco&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The first part of the above command is our query - <code>{title: &quot;Toro Loco&quot;}</code>. The second, is the operations that we want to run on the record that our query returns - <code>[{ $set: { price: 20 } }]</code></p> <p>The above command will update the first record it finds! However, what if there are lots of tastings of ToroLoco. This means our data, while usable, is not exactly optimised. Data optimisation is something that we will look at later. For now, you just need to know that you can update multiple records:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>tastings<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Toro Loco&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token number">20</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>We can also unset document properties:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>tastings<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Toro Loco&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token literal-property property">$unset</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>The above query removes the price property from our Toro Loco documents.</p> <p>A further useful operation is constructing new properties using other properties on the existing record:</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>tastings<span class="token punctuation">.</span><span class="token function">updateMany</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&quot;Toro Loco&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">oldPrice</span><span class="token operator">:</span> <span class="token string">&quot;$price&quot;</span><span class="token punctuation">,</span> <span class="token literal-property property">price</span><span class="token operator">:</span> <span class="token number">30</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>The above query sets the value of the current to &quot;oldPrice&quot;, then updates the price to 30.</p> <h2 id="task-3-updating-data"><a href="#task-3-updating-data" class="header-anchor">#</a> Task 3 - Updating Data</h2> <p>This, final task, starts off by getting you to perform simple update operations and moves on to more complex ones. We can use update operations to clean our data.</p> <ul><li><p>Can you update the price &quot;Gloria Ferrer NV Sonoma Brut Sparkling (Sonoma County)&quot; to 11?</p></li> <li><p>Can you figure out how to to move regions to an embedded array on each document in the tastings collection. After completion, you records should all look like this:</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'Toro Loco'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">regions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'Etna'</span><span class="token punctuation">,</span> <span class="token string">'France'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="advanced-tasks"><a href="#advanced-tasks" class="header-anchor">#</a> Advanced Tasks</h2> <ul><li><p>Can you figure out how to use the <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group" target="_blank" rel="noopener noreferrer">aggregation pipeline<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to output the details of each wine taster (e.g. name, twitter handle and number of tastings) to a new collection called tasters - this will take a little bit of research.</p></li> <li><p>Finally, continue to explore our data set and run some more advanced queries that will further clean the data</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/advanced-database-systems-2022/sessions/week_3/lecture.html" class="prev">
        Lecture (Start Here)
      </a></span> <span class="next"><a href="/advanced-database-systems-2022/sessions/week_4/lecture.html">
        Lecture (Start Here)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/advanced-database-systems-2022/assets/js/app.25060d71.js" defer></script><script src="/advanced-database-systems-2022/assets/js/2.4e8e5436.js" defer></script><script src="/advanced-database-systems-2022/assets/js/20.d353523c.js" defer></script>
  </body>
</html>
