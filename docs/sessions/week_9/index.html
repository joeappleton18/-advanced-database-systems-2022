<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Week 9 (Deploying to a Serverless Infrastructure)</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/advanced-database-systems-2022/assets/css/0.styles.83f0f393.css" as="style"><link rel="preload" href="/advanced-database-systems-2022/assets/js/app.dddf94b7.js" as="script"><link rel="preload" href="/advanced-database-systems-2022/assets/js/2.e8c6d7ef.js" as="script"><link rel="preload" href="/advanced-database-systems-2022/assets/js/6.b6251a91.js" as="script"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/10.b0f393ab.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/11.d9580ac5.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/12.5db88d17.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/13.0b258c17.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/14.2c457071.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/15.81ce7b57.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/16.b31105b3.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/17.6c6d975a.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/18.7a4272a1.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/19.0d35cd3c.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/20.9c017487.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/21.dfdc65a4.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/22.b4e1f9c1.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/23.e887c88e.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/24.b06d62cd.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/25.892f8982.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/26.33d2c884.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/27.c45dea18.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/28.84d4ab12.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/29.08193570.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/3.7885ed36.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/30.ea869e8a.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/31.b46dedd5.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/32.531015cf.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/33.7b38ae76.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/34.0dae5802.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/35.ef19626a.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/36.6cf01395.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/37.bde3a988.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/38.e5f57963.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/4.268bb457.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/5.0aff5690.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/7.43e13154.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/8.dc27223d.js"><link rel="prefetch" href="/advanced-database-systems-2022/assets/js/9.85f0ab95.js">
    <link rel="stylesheet" href="/advanced-database-systems-2022/assets/css/0.styles.83f0f393.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/advanced-database-systems-2022/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Assessment 1</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/advanced-database-systems-2022/sessions/assessment_1_project with individual report_brief.html" class="sidebar-link">Assessment 1: Project with Report (Due: Friday, 20th January 2023)</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/advanced-database-systems-2022/sessions/assessment_1_project with individual report_brief.html#assessment-1-project-with-report-due-friday-20th-january-2023" class="sidebar-link">Assessment 1: Project with Report (Due: Friday, 20th January 2023)</a></li><li class="sidebar-sub-header"><a href="/advanced-database-systems-2022/sessions/assessment_1_project with individual report_brief.html#assessment-task" class="sidebar-link">Assessment Task</a></li><li class="sidebar-sub-header"><a href="/advanced-database-systems-2022/sessions/assessment_1_project with individual report_brief.html#deliverable" class="sidebar-link">Deliverable</a></li><li class="sidebar-sub-header"><a href="/advanced-database-systems-2022/sessions/assessment_1_project with individual report_brief.html#assessment-criteria" class="sidebar-link">Assessment Criteria</a></li></ul></li><li><a href="/advanced-database-systems-2022/sessions/assessment_support.html" class="sidebar-link">Assessment FAQ</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 1 - Introduction to NodeJS and MongoDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Week 2 - Exploring Node, Express and Templates</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="week-9-deploying-to-a-serverless-infrastructure"><a href="#week-9-deploying-to-a-serverless-infrastructure" class="header-anchor">#</a> Week 9 (Deploying to a Serverless Infrastructure)</h1> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p><strong>Session Dependencies</strong></p> <p>This week we are continuing with our wine tasting theme. Please ensure you have the latest version
of the project</p> <p>You can clone this version using the following command:</p> <ul><li><code>git clone https://github.com/joeappleton18/db-starter-project.git --single-branch --branch week-8-solutions</code></li> <li>This week we need to be working on a master branch. Run, <code>git checkout -b master</code></li></ul></div> <p>This week marks the end of our journey in learning the basics of creating database applications. To complete this journey, we need to consider how we might deploy our application. As such, the primary question for this week is:</p> <h3 id="how-can-i-deploy-my-data-driven-web-applications-to-a-secure-and-scalable-infrastructure"><a href="#how-can-i-deploy-my-data-driven-web-applications-to-a-secure-and-scalable-infrastructure" class="header-anchor">#</a> How can I deploy my data-driven web applications to a secure and scalable infrastructure?</h3> <p>Deploying a web application used to be a slow and painful process. You would have to physically provision multiple servers (staging and production) and then use a protocol like FTP or SSH to upload changes and patches to our codebase. The issue with this approach, due to its cumbersome nature, deployments may happen infrequently. To live up to the agile manifesto of fast iterations and quick deployments we need a more versatile solution, and this solution comes in the form of a serverless infrastructures and cloud hosting.</p> <h2 id="modern-deployment-options"><a href="#modern-deployment-options" class="header-anchor">#</a> Modern Deployment Options</h2> <p>Both cloud hosting solutions (e.g., Digital Ocean) and serverless infrastructures (e.g., AWS, Google Cloud and Azure) circumvent the need for us to maintain any physical hardware, and both can scale along with increased application demand. The key difference between these two solutions is with cloud hosting we need to install and maintain the servers software, with a serverless solution this is handled for us. In summary, both are fine choices. However, the process of installing and patching software takes more human resource. As such, we are going to be exploring a serverless infrastructure for our wine tasting application.</p> <h2 id="what-is-a-serverless-infrastructure"><a href="#what-is-a-serverless-infrastructure" class="header-anchor">#</a> What is a serverless infrastructure</h2> <p>According to Amazon (AWS, the largest provider of such an infrastructure, <a href="https://aws.amazon.com/lambda/serverless-architectures-learn-more/" target="_blank" rel="noopener noreferrer">&quot;A serverless architecture is a way to build and run applications and services without having to manage infrastructure. Your application still runs on servers, but all the server management is done by AWS. &quot;<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. They claim that a serverless infrastructure affords us the following benefits:</p> <ul><li>No operating systems to choose, secure, patch, or manage.</li> <li>No servers to right size, monitor, or scale out.</li> <li>No risk to your cost by over-provisioning.</li> <li>No risk to your performance by under-provisioning.</li></ul> <p>The above benefits are all well and good; however, AWS is notoriously complex, and has a steep learning curve. Case in point, consider their infrastructure diagram for a simple todo list application:</p> <img src="https://joeappleton18.github.io/data-management-2021-notes/images/aws-infrastructure.png"> <blockquote><blockquote><p>A, not so simple, serverless todo list. Adapted, from a digram provided by AWS.</p></blockquote></blockquote> <p>Notice, in the above architectural digram, we have lambda functions (denoted by the lambda greek letter). These functions are discreet units of code that are executed through triggers. Lambda functions are an interesting proposition, as we only pay for them when they are invoked. However, such a set up is overkill for our little wine tasting application. As such, we are going to opt for services that offer a simplified abstraction layer over AWS.</p> <h2 id="our-infrastructure"><a href="#our-infrastructure" class="header-anchor">#</a> Our Infrastructure</h2> <img src="https://joeappleton18.github.io/data-management-2021-notes/images/wine-infrastructure.png"> <blockquote><blockquote><p>The infrastructure we are setting up this week - utilising Heroku and MongoDB Atlas.</p></blockquote></blockquote> <p>Rather than use AWS directly, we are going to be utilising two services that simplify its infrastructure - <a href="https://devcenter.heroku.com/" target="_blank" rel="noopener noreferrer">Heroku<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://www.mongodb.com/cloud/atlas/register" target="_blank" rel="noopener noreferrer">MongoDB Atlas<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Heroku allows us to quickly deploy applications to a lightweight, secure, virtualized Unix container - known as a dyno. Heroku allows us to deploy applications by simply pushing our codebase to a dedicated remote branch: <code>git push heroku master</code>. While Heroku will take care of running our node application, we'll use MongoDB Atlas to host our database. MongoDB atlas if a service offered by MongoDB which simplifies the process of provisioning and deploying cloud instances of MongoDB.</p> <h2 id="practical-session"><a href="#practical-session" class="header-anchor">#</a> Practical Session</h2> <p>We'll start the practical session by, first setting up our cloud database. Next, we'll move on to deploying our Node application to Heroku.</p> <h2 id="setting-up-our-cloud-database"><a href="#setting-up-our-cloud-database" class="header-anchor">#</a> Setting up our Cloud Database</h2> <p>Let's dive in and created a MongoDB Atlas account. This is a straight forward process:</p> <img src="https://joeappleton18.github.io/data-management-2021-notes/images/set-up-a-atlas-account.png"> <blockquote><blockquote><p>The first three steps in setting up a free Atlas Account.</p></blockquote></blockquote> <ul><li><a href="https://www.mongodb.com/cloud/atlas/register" target="_blank" rel="noopener noreferrer">Register a new account<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li> <li>On the next screen, you'll get the opportunity to set up a new project, name it &quot;wine&quot; and select JavaScript as the language choice.</li> <li>Select select a Free, shared, cluster.</li> <li>Finally, choose an AWS cloud provider and click &quot;Create Cluster&quot;</li></ul> <img src="https://joeappleton18.github.io/data-management-2021-notes/images/configuring-your-cluster.png"> <blockquote><blockquote><p>Configuring a cluster</p></blockquote></blockquote> <ul><li>Next, we need to follow through the steps to configure our database cluster</li> <li>Under database access, set up an admin user and password</li> <li>Under network access, allow access from all IPs</li> <li>Finally clusters, click connect to cluster, click connect using NodeJS and grab the connection string</li></ul> <h2 id="differentiating-between-development-and-production-a-little-trip-into-dev-ops"><a href="#differentiating-between-development-and-production-a-little-trip-into-dev-ops" class="header-anchor">#</a> Differentiating Between Development and Production - A little trip into DEV Ops</h2> <p>We need a way to allow us to differentiate between- We need to be able to differentiate between our production and development environment. In other words, we need to have two databases. One to hold our development data, and another to hold our production data.</p> <p>To begin with, we need a way to allow our database seeder to seed a production and development database. This can be achieved through injecting a <code>NODE_ENV</code> variable into our seeder:</p> <ol><li>We are going to use <code>cross-env</code> to allow us to dynamically set env variable in our <code>package.json</code> file. Install it: <code>npm install -D cross-env</code></li> <li>Next, add a <code>MONGODB__PRODUCTION_URI</code> property to your <code>.env</code> file. You'll notice that the URI you've been using for staging contains the name of the database. As long as you've created a cluster with Atlas DB you can create several databases in this cluster by updating the database name in the connection string. Let's update our connection strings so we have tw database <code>wine</code> and <code>wineDEV</code>:</li></ol> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token constant">MONGODB__PRODUCTION_URI</span><span class="token operator">=</span>mongodb<span class="token operator">+</span>srv<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>test<span class="token operator">:</span>xxxx@cluster0<span class="token punctuation">.</span>x08wt<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>net<span class="token operator">/</span>wine<span class="token operator">?</span>retryWrites<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>w<span class="token operator">=</span>majority
<span class="token constant">MONGODB_URI</span><span class="token operator">=</span>mongodb<span class="token operator">+</span>srv<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>xxxx<span class="token operator">:</span>test@cluster0<span class="token punctuation">.</span>x08wt<span class="token punctuation">.</span>mongodb<span class="token punctuation">.</span>net<span class="token operator">/</span>wineDev<span class="token operator">?</span>retryWrites<span class="token operator">=</span><span class="token boolean">true</span><span class="token operator">&amp;</span>w<span class="token operator">=</span>majority
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="3"><li>We can now set up some environment specific node scripts in <code>package.json</code>:</li></ol> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">...</span>
  <span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;seedProduction&quot;</span><span class="token operator">:</span> <span class="token string">&quot;cross-env NODE_ENV=production node seeder.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;seed&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node seeder.js&quot;</span>
  <span class="token punctuation">}</span>
   <span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>Notice how we are using <code>cross-env</code> to set the production environment. Also not, we are not setting a <code>NODE_ENV=development</code>.
I like to assume, unless explicitly stated, we are working in development.</p> <ul><li>Now, we can update the seeder to handle the production environment:</li></ul> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">...</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">MONGODB_URI</span><span class="token punctuation">,</span> <span class="token constant">MONGODB__PRODUCTION_URI</span> <span class="token punctuation">}</span> <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">;</span>
<span class="token comment">// don't copy and past this! It needs to be updated.</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoClient</span><span class="token punctuation">(</span>
  process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span> <span class="token operator">?</span> <span class="token constant">MONGODB__PRODUCTION_URI</span> <span class="token operator">:</span> <span class="token constant">MONGODB_URI</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>Notice how I am using the turnery operator to distinguish between production and dev.</li> <li>If all has gone well you should be able to seed production and development databases, by running:</li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">npm</span> run seed
<span class="token function">npm</span> run seedDevelopment
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="task-1-setting-up-atlas-db-and-seeding-the-production-database"><a href="#task-1-setting-up-atlas-db-and-seeding-the-production-database" class="header-anchor">#</a> Task 1 - Setting up Atlas DB and Seeding the Production Database</h2> <p>:::hint
If you already have a Atlas DB account, you can start from the second step.
:::</p> <ul><li>Follow the steps above to set up a new database cluster</li> <li>From your Atlas dash, click <code>clusters/collections</code>, and delete any existing databases that are in there. You may have one called <code>myFirstDatabase</code>, delete this.</li> <li>Follow steps above to seed a production database.</li></ul> <h2 id="setting-up-a-heroku-dyno"><a href="#setting-up-a-heroku-dyno" class="header-anchor">#</a> Setting up a Heroku Dyno</h2> <p>Now we have a database set up, we are ready to deploy our application to Heroku. This is actually a very painless process:</p> <h3 id="making-our-application-deployable"><a href="#making-our-application-deployable" class="header-anchor">#</a> Making our Application Deployable</h3> <p>To make our application deployable, we only need to make a few tweaks:</p> <ul><li><p>Ensure you are working on a master branch (see this weeks setup instruction, above)</p></li> <li><p>Specify the version of node we want in our hosting environment (Currently, supported versions are 10.x, 12.x, 14.x, and 15.x.). I am not sure why they skipped 13. We can do this by adding a scripts engines property in our <code>package.json</code> file:</p></li></ul> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">...</span>
  <span class="token string">&quot;engines&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;node&quot;</span><span class="token operator">:</span> <span class="token string">&quot;14.x&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><blockquote><p>package.json - add the engines property to your package.json object. 14 or 15 should be fine.</p></blockquote></blockquote> <ul><li>When our application is deployed, Heroku will look in our <code>package.json</code> file for a start script. It uses this script to run our app. Let's create a start command:</li></ul> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token operator">...</span>
<span class="token string">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;dev&quot;</span><span class="token operator">:</span> <span class="token string">&quot;nodemon app.js&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;start&quot;</span><span class="token operator">:</span> <span class="token string">&quot;node app.js&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token operator">...</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><blockquote><blockquote><p>package.json - a start script instructing heroku how to run our application</p></blockquote></blockquote> <ul><li><p>Finally, Heroku automatically binds our applications to port 80. In doing so it sets an environment variable called &quot;PORT&quot;. You'll notice, however, that we have our port assigned to the environment variable &quot;WEB_PORT&quot;. For simplicity, let's updated our application to use the environment variable &quot;PORT&quot;.</p> <ul><li>Updated your <code>.env</code> file <code>WEB_PORT</code> var to <code>PORT</code></li> <li>Within <code>app.js</code>, search and replace <code>WEB_PORT</code> to <code>PORT</code></li></ul></li></ul> <p>:::note
This section needs some installing, and we can't do this on the university computers. As such, you will need to do this at home.
:::</p> <h3 id="set-up"><a href="#set-up" class="header-anchor">#</a> Set Up</h3> <ul><li><a href="https://signup.heroku.com/signup/dc" target="_blank" rel="noopener noreferrer">Create a new Heroku account<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://devcenter.heroku.com/articles/heroku-cli#download-and-install" target="_blank" rel="noopener noreferrer">Download and install the Heroku CLI for your operating system<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>From within your project directory, in a terminal session run <code>heroku login</code></li> <li>Next, we need to create a new heroku application. From, within your project directory, in a terminal session run <code>heroku create</code></li> <li>If all has gone well, running <code>git remote -v</code> should reveal that a 'heroku' remote had been configured for you. We can use this remote to deploy, but first, we need set a environment variable. We only need need set an environment variable for <code>MONGODB_URI</code>, as <code>heroku</code> automatically sets the <code>PORT</code> for us. Also, if you check your heroku dash, you'll see that an application has been created for you.</li> <li>To set an environment variable for our heroku project, we simply need to run <code>heroku config:set VAR_NAME=VAR_VALUE</code>. As discussed, you only need to set an environment variable for <code>MONGODB_URI</code>. This should be set to the URL connection that you used earlier in your seeder. Set it as follows, <code>heroku config:set MONGODB_URI=&quot;YOUR PRODUCTION DB STRING&quot;</code>. You can also check, or set, this manually by looking in your <code>project settings -&gt; Config Vars</code>. (<strong>Note,</strong> you need the quotation marks)</li> <li>Within the VS code integrated terminal, type in <code>git branch</code> you may find you are on the branch <code>week-8-solutions</code>, we need to have a master branch that we are going to deploy. You can create one by making a commit (if you have file changes), and running <code>git checkout -b master</code></li> <li>We are now ready to deploy. First ensure you have committed the latest version of your work. Next, run <code>git push heroku master</code>. If all has gone well you should be able to access your application using the URL printed on your terminal output.</li></ul> <h2 id="task-2-deploying-your-web-application"><a href="#task-2-deploying-your-web-application" class="header-anchor">#</a> Task 2 - Deploying your Web Application</h2> <p>If you have a laptop, follow the steps above to deploy your wine tasting application to Heroku.</p> <h2 id="task-3-continuous-deployments"><a href="#task-3-continuous-deployments" class="header-anchor">#</a> Task 3 - Continuous Deployments</h2> <p><img src="/advanced-database-systems-2022/assets/img/git-deploy.666eb544.png" alt=""></p> <blockquote><blockquote><p>Automatic deployment enabled. Every time I push to the master branch, my project deploys!</p></blockquote></blockquote> <p>Let's see if we can use a git hook to deploy our work. This means that whenever we push to our git repos master branch, our project deploys.</p> <p><img src="/advanced-database-systems-2022/assets/img/config-vars.b4c21a29.png" alt=""></p> <blockquote><blockquote><p>You need to ensure you MONGODB_URI is set</p></blockquote></blockquote> <ul><li>If you are working from university, and have not installed the Heroku CLI:
<ul><li>create a new application in your <code>https://dashboard.heroku.com/</code>.</li> <li>within <code>project settings -&gt; Config Vars</code> set your MONGODB_URI to your production database</li></ul></li> <li><code>git remote remove origin</code></li> <li><code>git remote add origin &lt;your git repo address&gt;</code></li> <li>Push your code to GitHub, <code>git push origin master</code></li> <li>Within the VS code integrated terminal, type in <code>git branch</code> you may find you are on the branch <code>week-8-solutions</code>, we need to have a master branch that we are going to deploy. You can create one by making a commit (if you have file changes), and running <code>git checkout -b master</code></li> <li>Now, in your <code>https://dashboard.heroku.com/</code> , go to your <code>project --&gt; deploy</code> and click <code>GitHub</code>.
<ul><li>You'll then be able to connect your repository such that when you push to your projects master branch it deploys!</li></ul></li></ul> <h2 id="task-4-set-up-a-project-for-your-assessment"><a href="#task-4-set-up-a-project-for-your-assessment" class="header-anchor">#</a> Task 4 - Set up a Project for Your Assessment</h2> <p>Configure a new deployable project for your assessment</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/advanced-database-systems-2022/assets/js/app.dddf94b7.js" defer></script><script src="/advanced-database-systems-2022/assets/js/2.e8c6d7ef.js" defer></script><script src="/advanced-database-systems-2022/assets/js/6.b6251a91.js" defer></script>
  </body>
</html>
